#!/bin/bash

# Ensure we are on the main branch before bumping version
current_branch=$(git rev-parse --abbrev-ref HEAD)
if [ "$current_branch" != "main" ]; then
  echo "Version bump only on main branch. Skipping."
  exit 0
fi

# Check if the last commit is a version bump to avoid looping on re-push
last_commit_message=$(git log -1 --pretty=%B)
if [[ "$last_commit_message" == "bump version" ]]; then
  echo "Last commit is already a version bump. Skipping."
  exit 0
fi

# Bump version in package.json without creating a commit or tag yet
new_version_v=$(npm version minor --no-git-tag-version)
new_version=${new_version_v#v}

# Create the commit and tag
git add package.json
git commit -m "bump version"

exit 0
